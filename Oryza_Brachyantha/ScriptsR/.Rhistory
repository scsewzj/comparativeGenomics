singletons <- sum(!blast_files[[i]] %in% raw_accessions) # Not strictly needed, should be zero
# Actually, singletons = accessions in raw but not in filtered
singletons <- sum(!raw_accessions %in% blast_files[[i]])
counts_df <- rbind(counts_df,
data.frame(File = file_labels[i],
Hits = hits,
Sequences = sequences,
Singletons = singletons))
}
# Transform data for ggplot
counts_long <- counts_df %>%
pivot_longer(cols = c(Hits, Sequences, Singletons),
names_to = "Type",
values_to = "Count")
# Plot
p <- ggplot(counts_long, aes(x = File, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "dodge", color = NA) +
geom_text(aes(label = Count), position = position_dodge(width = 0.9), vjust = -0.5) +
scale_fill_manual(values = c("Hits" = "#6caed6", "Sequences" = "#cbaa7a", "Singletons" = "#bebebe")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
labs(y = "Count", x = "", fill = "Type") +
theme_minimal(base_size = 14) +
theme(panel.border = element_blank(),
axis.line = element_line(color = "black"),
legend.position = "top")
plot(p)
# Plot
p <- ggplot(counts_long, aes(x = File, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "dodge", color = NA) +
geom_text(aes(label = Count), position = position_dodge(width = 0.9), vjust = -0.5) +
scale_fill_manual(values = c("Hits" = "#6caed6", "Sequences" = "#cbaa7a", "Singletons" = "#bebebe")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
labs(y = "Count", x = "", fill = "Type") +
theme_minimal(base_size = 14) +
theme(panel.border = element_blank(),
axis.line = element_line(color = "black"))
plot(p)
# Plot
p <- ggplot(counts_long, aes(x = File, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "dodge", color = NA) +
geom_text(aes(label = Count), position = position_dodge(width = 0.9), vjust = -0.5) +
scale_fill_manual(values = c("Hits" = "#6caed6", "Sequences" = "#cbaa7a", "Singletons" = "#bebebe")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
labs(y = "# Hits", x = "") +
theme_minimal(base_size = 14) +
theme(panel.border = element_blank(),
axis.line = element_line(color = "black"))
plot(p)
# Plot
p <- ggplot(counts_long, aes(x = File, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "dodge", color = NA) +
geom_text(aes(label = Count), position = position_dodge(width = 0.9), vjust = -0.5) +
scale_fill_manual(values = c("Hits" = "#6caed6", "Sequences" = "#cbaa7a", "Singletons" = "#bebebe")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
labs(y = "# Hits", x = "") +
theme_minimal(base_size = 14)
plot(p)
# Plot
p <- ggplot(counts_long, aes(x = File, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "dodge", color = NA) +
geom_text(aes(label = Count), position = position_dodge(width = 0.9), vjust = -0.5) +
# scale_fill_manual(values = c("Hits" = "#6caed6", "Sequences" = "#cbaa7a", "Singletons" = "#bebebe")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
labs(y = "# Hits", x = "") +
theme_minimal(base_size = 14) +
theme(panel.border = element_blank(),
axis.line = element_line(color = "black"))
plot(p)
# Plot
p <- ggplot(counts_long, aes(x = File, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "dodge", color = NA) +
geom_text(aes(label = Count), position = position_dodge(width = 0.9), vjust = -0.5) +
scale_fill_manual(values = c("Hits" = "#6caed6", "Sequences" = "#cbaa7a", "Singletons" = "#bebebe")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
labs(y = "# Hits", x = "") +
theme_minimal(base_size = 14) +
theme(panel.border = element_blank(),
axis.line = element_line(color = "black"))
plot(p)
# Plot
p <- ggplot(counts_long, aes(x = File, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "dodge", color = NA) +
geom_text(aes(label = Count), position = position_dodge(width = 0.9), vjust = -0.5) +
scale_fill_manual(values = c("Hits" = "#6caed6", "Sequences" = "#cbaa7a", "Singletons" = "#bebebe")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
labs(y = "Count", x = "", fill = "Type") +
theme_minimal(base_size = 14) +
theme(panel.border = element_blank(),
axis.line = element_line(color = "black"),
legend.position = "none")
plot(p)
# Plot
p <- ggplot(counts_long, aes(x = File, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "dodge", color = NA) +
geom_text(aes(label = Count), position = position_dodge(width = 0.9), vjust = -0.5) +
scale_fill_manual(values = c("Hits" = "#6caed6", "Sequences" = "#cbaa7a", "Singletons" = "#bebebe")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
labs(y = "Count", x = "", fill = "Type") +
theme_minimal(base_size = 14) +
theme(panel.border = element_blank(),
axis.line = element_line(color = "black"))
plot(p)
# Plot
p <- ggplot(counts_long, aes(x = File, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "dodge", color = NA) +
geom_text(aes(label = Count), position = position_dodge(width = 0.9), vjust = -0.5) +
scale_fill_manual(values = c("Hits" = "#6caed6", "Sequences" = "#cbaa7a", "Singletons" = "#bebebe")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
labs(y = "# Hits", x = "", fill = "Type") +
theme_minimal(base_size = 14) +
theme(panel.border = element_blank(),
axis.line = element_line(color = "black"))
plot(p)
# Plot
p <- ggplot(counts_long, aes(x = File, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "dodge", color = NA) +
geom_text(aes(label = Count), position = position_dodge(width = 0.9), vjust = -0.5) +
scale_fill_manual(values = c("Hits" = "#6caed6", "Sequences" = "#cbaa7a", "Singletons" = "#bebebe")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
labs(y = "# Hits", x = "", fill = "Type") +
theme_minimal(base_size = 14) +
ggtitle("O. brachyantha") +
theme(panel.border = element_blank(),
axis.line = element_line(color = "black"))
plot(p)
# Plot
p <- ggplot(counts_long, aes(x = File, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "dodge", color = NA) +
geom_text(aes(label = Count), position = position_dodge(width = 0.9), vjust = -0.5) +
scale_fill_manual(values = c("Hits" = "#6caed6", "Sequences" = "#cbaa7a", "Singletons" = "#bebebe")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
labs(y = "# Hits", x = "", fill = "Type") +
theme_minimal(base_size = 14) +
ggtitle("O. brachyantha",face="bold.italic") +
theme(panel.border = element_blank(),
axis.line = element_line(color = "black"))
# Plot
p <- ggplot(counts_long, aes(x = File, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "dodge", color = NA) +
geom_text(aes(label = Count), position = position_dodge(width = 0.9), vjust = -0.5) +
scale_fill_manual(values = c("Hits" = "#6caed6", "Sequences" = "#cbaa7a", "Singletons" = "#bebebe")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
labs(y = "# Hits", x = "", fill = "Type") +
theme_minimal(base_size = 14) +
ggtitle("O. brachyantha") +
theme(panel.border = element_blank(),
axis.line = element_line(color = "black"),
plot.title = element_text(face="bold.italic"))
plot(p)
# Plot
p <- ggplot(counts_long, aes(x = File, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "dodge", color = NA) +
geom_text(aes(label = Count), position = position_dodge(width = 0.9), vjust = -0.5) +
scale_fill_manual(values = c("Hits" = "#6caed6", "Sequences" = "#cbaa7a", "Singletons" = "#bebebe")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
labs(y = "# Hits", x = "", fill = "Type") +
theme_minimal(base_size = 14) +
ggtitle("O. brachyantha") +
theme(panel.border = element_blank(),
axis.line = element_line(color = "black"),
plot.title = element_text(face="italic"))
# Plot
p <- ggplot(counts_long, aes(x = File, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "dodge", color = NA) +
geom_text(aes(label = Count), position = position_dodge(width = 0.9), vjust = -0.5) +
scale_fill_manual(values = c("Hits" = "#6caed6", "Sequences" = "#cbaa7a", "Singletons" = "#bebebe")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
labs(y = "# Hits", x = "", fill = "Type") +
theme_minimal(base_size = 14) +
ggtitle("O. brachyantha") +
theme(panel.border = element_blank(),
axis.line = element_line(color = "black"),
plot.title = element_text(face="italic"))
plot(p)
# Plot
p <- ggplot(counts_long, aes(x = File, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "dodge", color = NA) +
geom_text(aes(label = Count), position = position_dodge(width = 0.9), vjust = -0.5) +
scale_fill_manual(values = c("Hits" = "#6caed6", "Sequences" = "#cbaa7a", "Singletons" = "#bebebe")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
labs(y = "# Hits", x = "", fill = "Type") +
theme_minimal(base_size = 14) +
ggtitle("O. brachyantha") +
theme(panel.border = element_blank(),
axis.line = element_line(color = "black"),
plot.title = element_text(face="italic", position="right"))
plot(p)
plot(p)
# Plot
p <- ggplot(counts_long, aes(x = File, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "dodge", color = NA) +
geom_text(aes(label = Count), position = position_dodge(width = 0.9), vjust = -0.5) +
scale_fill_manual(values = c("Hits" = "#6caed6", "Sequences" = "#cbaa7a", "Singletons" = "#bebebe")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
labs(y = "# Hits", x = "", fill = "Type") +
theme_minimal(base_size = 14) +
ggtitle("O. brachyantha") +
theme(panel.border = element_blank(),
axis.line = element_line(color = "black"),
plot.title = element_text(face="italic"), axis.title.x = element_text(face="italic"))
# Plot
p <- ggplot(counts_long, aes(x = File, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "dodge", color = NA) +
geom_text(aes(label = Count), position = position_dodge(width = 0.9), vjust = -0.5) +
scale_fill_manual(values = c("Hits" = "#6caed6", "Sequences" = "#cbaa7a", "Singletons" = "#bebebe")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
labs(y = "# Hits", x = "", fill = "Type") +
theme_minimal(base_size = 14) +
ggtitle("O. brachyantha") +
theme(panel.border = element_blank(),
axis.line = element_line(color = "black"),
plot.title = element_text(face="italic"), axis.title.x = element_text(face="bold"))
plot(p)
# Plot
p <- ggplot(counts_long, aes(x = File, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "dodge", color = NA) +
geom_text(aes(label = Count), position = position_dodge(width = 0.9), vjust = -0.5) +
scale_fill_manual(values = c("Hits" = "#6caed6", "Sequences" = "#cbaa7a", "Singletons" = "#bebebe")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
labs(y = "# Hits", x = "", fill = "Type") +
theme_minimal(base_size = 14) +
ggtitle("O. brachyantha") +
theme(panel.border = element_blank(),
axis.line = element_line(color = "black"),
plot.title = element_text(face="italic")) +
theme(axis.title.x = element_text(face="bold"))
plot(p)
# Plot
p <- ggplot(counts_long, aes(x = File, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "dodge", color = NA) +
geom_text(aes(label = Count), position = position_dodge(width = 0.9), vjust = -0.5) +
scale_fill_manual(values = c("Hits" = "#6caed6", "Sequences" = "#cbaa7a", "Singletons" = "#bebebe")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
labs(y = "# Hits", x = "", fill = "Type") +
theme_minimal(base_size = 14) +
ggtitle("O. brachyantha") +
theme(panel.border = element_blank(),
axis.line = element_line(color = "black"),
plot.title = element_text(face="italic"),
axis.title.x = element_text(face="bold"))
plot(p)
# Plot
p <- ggplot(counts_long, aes(x = File, y = Count, fill = Type, border="white")) +
geom_bar(stat = "identity", position = "dodge", color = NA) +
geom_text(aes(label = Count), position = position_dodge(width = 0.9), vjust = -0.5) +
scale_fill_manual(values = c("Hits" = "#6caed6", "Sequences" = "#cbaa7a", "Singletons" = "#bebebe")) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
labs(y = "# Hits", x = "", fill = "Type") +
theme_minimal(base_size = 14) +
ggtitle("O. brachyantha") +
theme(panel.border = element_blank(),
axis.line = element_line(color = "black"),
plot.title = element_text(face="italic"),
axis.title.x = element_text(face="bold"))
plot(p)
# Plot histogram
mfrow(c(2,2))
# Plot histogram
par(mfrow=c(2,2))
L_file  <- ifelse(length(args) >= 1, args[1], "../KaKs_all_ks_input_moderate.tsv")
H_file  <- ifelse(length(args) >= 1, args[1], "../KaKs_all_ks_input_strict.tsv")
output_file <- ifelse(length(args) >= 2, args[2], "dS_SE_vs_dS.png")
# ========================
# Load data
# ========================
dfL <- read.table(L_file, header = TRUE, sep = "\t", stringsAsFactors = FALSE)
dfH <- read.table(H_file, header = TRUE, sep = "\t", stringsAsFactors = FALSE)
# Basic sanity check
required_cols <- c("dS", "dS_SE")
missing_cols <- setdiff(required_cols, colnames(df))
if (length(missing_cols) > 0) {
stop(paste("Missing required columns:", paste(missing_cols, collapse = ", ")))
}
missing_colsL <- setdiff(required_cols, colnames(dfL))
missing_colsH <- setdiff(required_cols, colnames(dfH))
if (length(missing_colsH) > 0) {
stop(paste("Missing required columns:", paste(missing_cols, collapse = ", ")))
}
if (length(missing_colsL) > 0) {
stop(paste("Missing required columns:", paste(missing_cols, collapse = ", ")))
}
# Remove invalid values
threshold_SE <- 100
threshold <- 6
# Remove invalid values
threshold_SE <- 5
threshold <- 6
df1 <- dfL[is.finite(dfL$dS) & is.finite(dfL$dS_SE) & dfL$dS >= 0 & dfL$dS < threshold]
dfL
df1 <- dfL[is.finite(dfL$dS) & is.finite(dfL$dS_SE) & dfL$dS >= 0 & dfL$dS < threshold]
df2 <- dfL[is.finite(dfL$dS) & is.finite(dfL$dS_SE) & dfL$dS >= 0 & dfL$dS < threshold & dfL$dS_SE <= threshold_SE, ]
df3 <- dfS[is.finite(dfS$dS) & is.finite(dfS$dS_SE) & dfS$dS >= 0 & dfS$dS < threshold]
df4 <- dfS[is.finite(dfS$dS) & is.finite(dfS$dS_SE) & dfS$dS >= 0 & dfS$dS < threshold & dfS$dS_SE <= threshold_SE, ]
df1 <- dfL[is.finite(dfL$dS) & is.finite(dfL$dS_SE) & dfL$dS >= 0 & dfL$dS < threshold]
# ========================
# Load data
# ========================
dfL <- read.table(L_file, header = TRUE, sep = "\t", stringsAsFactors = FALSE)
source("C:/Users/Emilie-jeanne/Downloads/Project_Comparative_Genomics/comparativeGenomics/Oryza_Brachyantha/ScriptsR/Ks_SEdS.R", echo = TRUE)
# ========================
# Plot
# ========================
par(mfrow=c(2,2))
p <- ggplot(df2, aes(x = dS, y = dS_SE)) +
geom_point(alpha = 0.5, size = 1) +
labs(
title = paste("dS_SE as a Function of dS<",threshold),
x = "dS (synonymous substitutions per site)",
y = "SE(dS)"
) +
theme_minimal(base_size = 12)
plot(p)
df1 <- dfL[is.finite(dfL$dS) & is.finite(dfL$dS_SE) & dfL$dS >= 0 & dfL$dS < threshold,]
df2 <- dfL[is.finite(dfL$dS) & is.finite(dfL$dS_SE) & dfL$dS >= 0 & dfL$dS < threshold & dfL$dS_SE <= threshold_SE, ]
df3 <- dfH[is.finite(dfH$dS) & is.finite(dfH$dS_SE) & dfH$dS >= 0 & dfH$dS < threshold,]
df4 <- dfH[is.finite(dfH$dS) & is.finite(dfH$dS_SE) & dfH$dS >= 0 & dfH$dS < threshold & dfH$dS_SE <= threshold_SE, ]
# ========================
# Plot
# ========================
library(patchwork)
# Create individual plots
p1 <- ggplot(df1, aes(x = dS, y = dS_SE)) +
geom_point(alpha = 0.5, size = 1) +
labs(title = "dfL all", x = "dS", y = "SE(dS)") +
theme_minimal(base_size = 12)
p2 <- ggplot(df2, aes(x = dS, y = dS_SE)) +
geom_point(alpha = 0.5, size = 1) +
labs(title = "dfL filtered", x = "dS", y = "SE(dS)") +
theme_minimal(base_size = 12)
p3 <- ggplot(df3, aes(x = dS, y = dS_SE)) +
geom_point(alpha = 0.5, size = 1) +
labs(title = "dfH all", x = "dS", y = "SE(dS)") +
theme_minimal(base_size = 12)
p4 <- ggplot(df4, aes(x = dS, y = dS_SE)) +
geom_point(alpha = 0.5, size = 1) +
labs(title = "dfH filtered", x = "dS", y = "SE(dS)") +
theme_minimal(base_size = 12)
# Combine in 2x2 layout
combined_plot <- (p1 | p2) / (p3 | p4)
# Display
print(combined_plot)
# Display
plot(combined_plot)
length(df1)
dim(df1)$1
dim(df1)[1]
dim(df1)[2]
dim(df1)[1]*dim(df1)[2]
# Create individual plots
p1 <- ggplot(df1, aes(x = dS, y = dS_SE)) +
geom_point(alpha = 0.5, size = 1) +
labs(title = paste("(L) O.brachyantha| dS <6\n",dim(df1)[1]*dim(df1)[2],"genes"),
x = "dS", y = "SE(dS)") +
theme_minimal(base_size = 12)
p2 <- ggplot(df2, aes(x = dS, y = dS_SE)) +
geom_point(alpha = 0.5, size = 1) +
labs(title = paste("(L) O.brachyantha| dS <6, SE< 5\n",dim(df2)[1]*dim(df2)[2],"genes"),
x = "dS", y = "SE(dS)") +
theme_minimal(base_size = 12)
p3 <- ggplot(df3, aes(x = dS, y = dS_SE)) +
geom_point(alpha = 0.5, size = 1) +
labs(title = paste("(H) O.brachyantha| dS <6\n",dim(df3)[1]*dim(df3)[2],"genes"),
x = "dS", y = "SE(dS)") +
theme_minimal(base_size = 12)
p4 <- ggplot(df4, aes(x = dS, y = dS_SE)) +
geom_point(alpha = 0.5, size = 1) +
labs(title = paste("(H) O.brachyantha| dS <6, SE< 5\n",dim(df4)[1]*dim(df4)[2],"genes"), x = "dS", y = "SE(dS)") +
theme_minimal(base_size = 12)
# Combine in 2x2 layout
combined_plot <- (p1 | p2) / (p3 | p4)
# Display
plot(combined_plot)
# Create individual plots
p1 <- ggplot(df1, aes(x = dS, y = dS_SE)) +
geom_point(alpha = 0.5, size = 1) +
labs(title = paste("A. dS <6\n",dim(df1)[1]*dim(df1)[2],"genes"),
x = "dS", y = "SE(dS)") +
theme_minimal(base_size = 12)
p2 <- ggplot(df2, aes(x = dS, y = dS_SE)) +
geom_point(alpha = 0.5, size = 1) +
labs(title = paste("B. dS <6, SE< 5\n",dim(df2)[1]*dim(df2)[2],"genes"),
x = "dS", y = "SE(dS)") +
theme_minimal(base_size = 12)
p3 <- ggplot(df3, aes(x = dS, y = dS_SE)) +
geom_point(alpha = 0.5, size = 1) +
labs(title = paste("C. dS <6\n",dim(df3)[1]*dim(df3)[2],"genes"),
x = "dS", y = "SE(dS)") +
theme_minimal(base_size = 12)
p4 <- ggplot(df4, aes(x = dS, y = dS_SE)) +
geom_point(alpha = 0.5, size = 1) +
labs(title = paste("D. dS <6, SE< 5\n",dim(df4)[1]*dim(df4)[2],"genes"), x = "dS", y = "SE(dS)") +
theme_minimal(base_size = 12)
# Combine in 2x2 layout
combined_plot <- (p1 | p2) / (p3 | p4)
# Display
plot(combined_plot)
# Create individual plots
p1 <- ggplot(df1, aes(x = dS, y = dS_SE)) +
geom_point(alpha = 0.5, size = 1) +
labs(title = paste("A. (L) dS <6\n",dim(df1)[1]*dim(df1)[2],"genes"),
x = "dS", y = "SE(dS)") +
theme_minimal(base_size = 12)
p2 <- ggplot(df2, aes(x = dS, y = dS_SE)) +
geom_point(alpha = 0.5, size = 1) +
labs(title = paste("B. (L) dS <6, SE< 5\n",dim(df2)[1]*dim(df2)[2],"genes"),
x = "dS", y = "SE(dS)") +
theme_minimal(base_size = 12)
p3 <- ggplot(df3, aes(x = dS, y = dS_SE)) +
geom_point(alpha = 0.5, size = 1) +
labs(title = paste("C. (H) dS <6\n",dim(df3)[1]*dim(df3)[2],"genes"),
x = "dS", y = "SE(dS)") +
theme_minimal(base_size = 12)
p4 <- ggplot(df4, aes(x = dS, y = dS_SE)) +
geom_point(alpha = 0.5, size = 1) +
labs(title = paste("D. (H) dS <6, SE< 5\n",dim(df4)[1]*dim(df4)[2],"genes"), x = "dS", y = "SE(dS)") +
theme_minimal(base_size = 12)
# Combine in 2x2 layout
combined_plot <- (p1 | p2) / (p3 | p4)
# Display
plot(combined_plot)
# Create individual plots
p1 <- ggplot(df1, aes(x = dS, y = dS_SE)) +
geom_point(alpha = 0.5, size = 1) +
labs(title = paste("A. (L) dS <6\n",dim(df1)[1]*dim(df1)[2],"pairs"),
x = "dS", y = "SE(dS)") +
theme_minimal(base_size = 12)
p2 <- ggplot(df2, aes(x = dS, y = dS_SE)) +
geom_point(alpha = 0.5, size = 1) +
labs(title = paste("B. (L) dS <6, SE< 5\n",dim(df2)[1]*dim(df2)[2],"pairs"),
x = "dS", y = "SE(dS)") +
theme_minimal(base_size = 12)
p3 <- ggplot(df3, aes(x = dS, y = dS_SE)) +
geom_point(alpha = 0.5, size = 1) +
labs(title = paste("C. (H) dS <6\n",dim(df3)[1]*dim(df3)[2],"pairs"),
x = "dS", y = "SE(dS)") +
theme_minimal(base_size = 12)
p4 <- ggplot(df4, aes(x = dS, y = dS_SE)) +
geom_point(alpha = 0.5, size = 1) +
labs(title = paste("D. (H) dS <6, SE< 5\n",dim(df4)[1]*dim(df4)[2],"pairs"), x = "dS", y = "SE(dS)") +
theme_minimal(base_size = 12)
# Combine in 2x2 layout
combined_plot <- (p1 | p2) / (p3 | p4)
# Display
plot(combined_plot)
# Load libraries
library(ggplot2)
library(reshape2)
# ========================
# Parse command-line args
# ========================
args <- commandArgs(trailingOnly = TRUE)
blast_file  <- ifelse(length(args) >= 1, args[1], "append_all_vs_all.tsv") # Input file
header      <- ifelse(length(args) >= 2, as.logical(args[2]), FALSE)
sep_char    <- ifelse(length(args) >= 3, args[3], "")
plot_dir <- "plots"
# ------------------------
# Create output directory
# ------------------------
if (!dir.exists(plot_dir)) {
dir.create(plot_dir, recursive = TRUE)
}
# Read the BLAST-like file
blast <- read.table(blast_file, header = header, sep = sep_char, stringsAsFactors = FALSE)
# ========================
# Parse command-line args
# ========================
args <- commandArgs(trailingOnly = TRUE)
blast_file  <- ifelse(length(args) >= 1, args[1], "../append_all_vs_all.tsv") # Input file
header      <- ifelse(length(args) >= 2, as.logical(args[2]), FALSE)
sep_char    <- ifelse(length(args) >= 3, args[3], "")
plot_dir <- "plots"
# ------------------------
# Create output directory
# ------------------------
if (!dir.exists(plot_dir)) {
dir.create(plot_dir, recursive = TRUE)
}
# Read the BLAST-like file
blast <- read.table(blast_file, header = header, sep = sep_char, stringsAsFactors = FALSE)
# Assign column names (14 fields)
colnames(blast) <- c("Query", "Subject", "PercIdentity", "AlignLength", "Mismatches",
"GapOpens", "Qstart", "Qend", "Sstart", "Send", "Evalue",
"BitScore", "QueryLength", "SubjectLength")
# ------------------------
# Calculate coverage
# ------------------------
blast$QueryCoverage <- (blast$Qend - blast$Qstart + 1) / blast$QueryLength * 100
blast$SubjectCoverage <- (blast$Send - blast$Sstart + 1) / blast$SubjectLength * 100
# ------------------------
# Select columns to plot
# ------------------------
df_plot <- blast[, c("PercIdentity", "QueryCoverage", "SubjectCoverage")]
# Melt for ggplot
df_melt <- melt(df_plot, variable.name = "Metric", value.name = "Value")
# ------------------------
# Plot distributions with vertical line legend
# ------------------------
vline_data <- data.frame(xintercept = c(50, 70),
LineType = c("50%", "70%"))
p <- ggplot(df_melt, aes(x = Value, fill = Metric)) +
geom_histogram(alpha = 0.6, bins = 30, position = "identity", color = NA) +
facet_wrap(~Metric, scales = "free") +
theme_minimal() +
labs(title = "BLAST Hit Metrics Distribution",
x = "Percentage",
y = "Count") +
geom_vline(data = vline_data, aes(xintercept = xintercept, color = LineType),
linetype = "dashed", linewidth = 0.8, show.legend = TRUE) +
scale_color_manual(name = "Thresholds", values = c("50%" = "red", "70%" = "blue")) +
theme(legend.position = "right")
# Print plot
print(p)
